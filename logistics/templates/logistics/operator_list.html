{% extends 'logistics/base.html' %}

{% block title %}Operators List - {{ selected_month|date:"F Y" }}{% endblock %}

{% block content %}
<header>
    <h1>üë• Operators & Drivers</h1>
    <p>Performance Overview for {{ selected_month|date:"F Y" }}</p>
</header>

<div class="controls">
    <a href="{% url 'logistics:dashboard' %}?month={{ selected_month|date:'Y-m' }}">
        <button type="button">‚Üê Back to Dashboard</button>
    </a>

    <form method="get" action="" style="display: flex; gap: 1rem; align-items: center;">
        <label for="month-select">Month:</label>
        <select name="month" id="month-select" onchange="this.form.submit()">
            {% for month in available_months %}
            <option value="{{ month|date:'Y-m' }}" {% if month==selected_month %}selected{% endif %}>
                {{ month|date:"F Y" }}
            </option>
            {% empty %}
            <option value="{{ selected_month|date:'Y-m' }}" selected>
                {{ selected_month|date:"F Y" }}
            </option>
            {% endfor %}
        </select>
    </form>
</div>

<div class="data-table">
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Status</th>
                <th>Last Activity</th>
                <th>Time Spent</th>
                <th>Total Visits</th>
                <th>Machines Visited</th>
                <th>Avg Monthly Rating</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for op in operators %}
            <tr>
                <td>
                    <a href="{% url 'logistics:operator_detail' op.id %}?month={{ selected_month|date:'Y-m' }}"
                        style="font-weight: bold;">
                        {{ op.name }}
                    </a>
                </td>
                <td>
                    {% if op.is_driver %}
                    <span class="badge badge-warning">Driver</span>
                    {% else %}
                    <span class="badge badge-success">Operator</span>
                    {% endif %}
                </td>
                <td>
                    {% if op.status == 'checked_in' %}
                    <span class="op-status-badge checked-in">{{ op.status_label }}</span>
                    {% elif op.status == 'checked_out' %}
                    <span class="op-status-badge checked-out">{{ op.status_label }}</span>
                    {% elif op.status == 'checking_in' or op.status == 'checking_out' %}
                    <span class="op-status-badge in-progress">{{ op.status_label }}</span>
                    {% else %}
                    <span class="op-status-badge no-activity">{{ op.status_label }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if op.status_time %}
                    <span style="font-size: 0.8rem;">{{ op.status_time|date:"M d, H:i" }}</span>
                    {% else %}
                    <span style="color: var(--text-secondary);">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if op.time_spent %}
                    <span style="font-weight: 600; color: var(--primary);">‚è± {{ op.time_spent }}</span>
                    {% else %}
                    <span style="color: var(--text-secondary);">-</span>
                    {% endif %}
                </td>
                <td>{{ op.visit_count }}</td>
                <td>{{ op.machine_count }}</td>
                <td>
                    {% if op.monthly_avg_rating != '-' %}
                    <span style="font-weight: bold; color: var(--text-primary);">‚≠ê {{ op.monthly_avg_rating }}/10</span>
                    {% else %}
                    <span style="color: var(--text-secondary);">-</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'logistics:operator_detail' op.id %}?month={{ selected_month|date:'Y-m' }}">
                        <button type="button" class="small">View Profile</button>
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" style="text-align: center; padding: 2rem;">No operators found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    button.small {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        background-color: var(--primary);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    button.small:hover {
        background-color: var(--primary-hover);
    }

    .op-status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
    }

    .op-status-badge.checked-in {
        background: rgba(0, 184, 148, 0.15);
        border: 1px solid rgba(0, 184, 148, 0.4);
        color: #00b894;
    }

    .op-status-badge.checked-out {
        background: rgba(108, 92, 231, 0.12);
        border: 1px solid rgba(108, 92, 231, 0.35);
        color: #6c5ce7;
    }

    .op-status-badge.in-progress {
        background: rgba(253, 203, 110, 0.15);
        border: 1px solid rgba(253, 203, 110, 0.4);
        color: #fdcb6e;
    }

    .op-status-badge.no-activity {
        background: var(--bg-hover);
        color: var(--text-secondary);
    }
</style>

{% endblock %}